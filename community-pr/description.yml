# =============================================================================
# DuckDB Community Extension Descriptor for dplyr
# =============================================================================
# This file should be submitted to duckdb/community-extensions repository
# Path: extensions/dplyr/description.yml
# =============================================================================

extension:
  name: dplyr
  description: R dplyr pipeline syntax support for DuckDB - transpiles dplyr verbs to SQL
  version: 0.1.0
  language: C++
  build: cmake
  license: MIT
  requires_toolchains: "rust"
  excluded_platforms: "linux_amd64_musl"
  maintainers:
    - mrchypark

repo:
  github: mrchypark/libdplyr
  ref: e88db555963c958ff4e02f11afe2a5203041d112

docs:
  hello_world: |
    -- Transform R dplyr pipeline syntax directly in DuckDB
    -- First, create a sample table
    CREATE TABLE iris AS SELECT * FROM (VALUES
      (5.1, 3.5, 1.4, 0.2, 'setosa'),
      (4.9, 3.0, 1.4, 0.2, 'setosa'),
      (7.0, 3.2, 4.7, 1.4, 'versicolor'),
      (6.4, 3.2, 4.5, 1.5, 'versicolor'),
      (6.3, 3.3, 6.0, 2.5, 'virginica'),
      (5.8, 2.7, 5.1, 1.9, 'virginica')
    ) AS t(sepal_length, sepal_width, petal_length, petal_width, species);

    -- Use dplyr table function with R-style pipeline syntax
    SELECT * FROM dplyr('
      iris %>%
        filter(sepal_length > 5) %>%
        select(species, sepal_length, petal_length) %>%
        arrange(desc(sepal_length))
    ');
    ┌────────────┬──────────────┬──────────────┐
    │  species   │ sepal_length │ petal_length │
    ├────────────┼──────────────┼──────────────┤
    │ versicolor │          7.0 │          4.7 │
    │ versicolor │          6.4 │          4.5 │
    │ virginica  │          6.3 │          6.0 │
    │ virginica  │          5.8 │          5.1 │
    │ setosa     │          5.1 │          1.4 │
    └────────────┴──────────────┴──────────────┘

    -- Group and summarize with dplyr syntax
    SELECT * FROM dplyr('
      iris %>%
        group_by(species) %>%
        summarise(
          avg_sepal = mean(sepal_length),
          count = n()
        )
    ');
    ┌────────────┬───────────┬───────┐
    │  species   │ avg_sepal │ count │
    ├────────────┼───────────┼───────┤
    │ setosa     │      5.00 │     2 │
    │ versicolor │      6.70 │     2 │
    │ virginica  │      6.05 │     2 │
    └────────────┴───────────┴───────┘

    -- Create derived columns with mutate
    SELECT * FROM dplyr('
      iris %>%
        mutate(sepal_ratio = sepal_length / sepal_width) %>%
        select(species, sepal_ratio) %>%
        arrange(sepal_ratio)
    ');

  extended_description: |
    `dplyr` is a DuckDB extension that brings R's popular dplyr package syntax to DuckDB.
    It transpiles dplyr pipeline syntax (using the `%>%` pipe operator) directly to SQL,
    allowing R users to write familiar data manipulation code in DuckDB.

    **Supported dplyr Verbs:**
    - `select()` - Choose columns by name
    - `filter()` - Filter rows based on conditions
    - `mutate()` - Create new columns or modify existing ones
    - `arrange()` - Sort rows (supports `desc()` for descending order)
    - `group_by()` - Group data by one or more columns
    - `summarise()` / `summarize()` - Aggregate grouped data
    - `rename()` - Rename columns

    **Aggregation Functions:**
    - `n()` - Count rows
    - `mean()` - Average
    - `sum()` - Sum
    - `min()` / `max()` - Minimum / Maximum
    - `first()` / `last()` - First / Last value

    **Key Features:**
    - Native R dplyr syntax support with `%>%` pipe operator
    - Transpiles to optimized SQL at runtime
    - Works with any DuckDB table
    - Error messages include helpful diagnostics

    **Usage:**
    ```sql
    -- Using the dplyr() table function
    SELECT * FROM dplyr('table_name %>% filter(x > 5) %>% select(a, b)');
    ```

    For more information, visit the [GitHub repository](https://github.com/mrchypark/libdplyr).
