# GitHub Actions Workflows

이 디렉토리는 DuckDB dplyr 확장의 CI/CD 파이프라인을 정의합니다.

## 워크플로우 개요

### 🔄 CI/CD Pipeline (`ci.yml`)
**트리거**: Push, Pull Request, Release
**목적**: 멀티플랫폼 빌드, 테스트, 아티팩트 생성

- **빌드 매트릭스**: Linux x86_64, macOS x86_64/ARM64, Windows x86_64
- **테스트 실행**: Rust 단위 테스트, C++ 통합 테스트, 스모크 테스트
- **품질 검사**: 코드 포맷팅, Clippy, 보안 감사
- **아티팩트**: 플랫폼별 확장 바이너리, 테스트 결과

**요구사항 충족**:
- ✅ R4-AC1: 멀티플랫폼 빌드 지원
- ✅ R4-AC2: 자동화된 스모크 테스트
- ✅ R7-AC1: 통합 테스트 실행
- ✅ R7-AC3: 크래시 방지 테스트

### 🔒 Security Checks (`security.yml`)
**트리거**: Push, Pull Request, 스케줄 (매일 2 AM UTC)
**목적**: 보안 취약점 및 라이선스 컴플라이언스 검사

- **보안 감사**: cargo-audit를 통한 의존성 취약점 검사
- **라이선스 검사**: cargo-deny를 통한 라이선스 호환성 확인
- **정적 분석**: Clippy 보안 린트, cargo-geiger unsafe 코드 분석
- **CodeQL**: GitHub의 코드 보안 분석

### ⚡ Performance Benchmarks (`benchmark.yml`)
**트리거**: Push (main), Pull Request, 스케줄 (주간), 수동 실행
**목적**: 성능 회귀 방지 및 벤치마크 추적

- **Rust 벤치마크**: 트랜스파일레이션 성능 측정
- **통합 성능**: 확장 로딩 시간, 쿼리 성능, 메모리 사용량
- **성능 목표**: 단순 쿼리 <2ms, 복잡 쿼리 <15ms, 로딩 <50ms
- **회귀 감지**: 성능 목표 미달 시 빌드 실패

**요구사항 충족**:
- ✅ R6-AC1: 성능 목표 검증 (2ms/15ms)
- ✅ R6-AC2: 확장 로딩 시간 (<50ms)
- ✅ R6-AC3: 메모리 사용량 모니터링

### 🚀 Release (`release.yml`)
**트리거**: Release 게시, 수동 실행
**목적**: 멀티플랫폼 릴리스 빌드 및 배포

- **릴리스 빌드**: 최적화된 릴리스 바이너리 생성
- **품질 보증**: 릴리스 바이너리 로딩 테스트
- **패키징**: 플랫폼별 확장, 체크섬, 설치 스크립트
- **GitHub Release**: 자동 릴리스 생성 및 아티팩트 업로드

**요구사항 충족**:
- ✅ R4-AC3: 멀티플랫폼 바이너리 패키징
- ✅ R8-AC3: 자동화된 릴리스 및 메타데이터

## 워크플로우 상태

<!-- 이 배지들은 실제 리포지토리에서 업데이트되어야 합니다 -->
![CI/CD](https://github.com/your-org/libdplyr-duckdb/workflows/CI/CD%20Pipeline/badge.svg)
![Security](https://github.com/your-org/libdplyr-duckdb/workflows/Security%20Checks/badge.svg)
![Benchmarks](https://github.com/your-org/libdplyr-duckdb/workflows/Performance%20Benchmarks/badge.svg)

## 플랫폼 지원

| 플랫폼 | 아키텍처 | 빌드 | 테스트 | 릴리스 |
|--------|----------|------|--------|--------|
| Linux | x86_64 | ✅ | ✅ | ✅ |
| macOS | x86_64 | ✅ | ✅ | ✅ |
| macOS | ARM64 | ✅ | ✅ | ✅ |
| Windows | x86_64 | ✅ | ✅ | ✅ |

## 환경 변수

### 공통 환경 변수
- `CARGO_TERM_COLOR=always`: Rust 출력 색상 활성화
- `RUST_BACKTRACE=1`: Rust 백트레이스 활성화

### 워크플로우별 환경 변수
- `DUCKDB_EXTENSION_PATH`: 확장 파일 경로 (테스트용)
- `DPLYR_DEBUG`: 디버그 로깅 활성화
- `VALGRIND_AVAILABLE`: Valgrind 메모리 검사 활성화 (Linux)

## 아티팩트 보존 정책

| 아티팩트 타입 | 보존 기간 | 설명 |
|---------------|-----------|------|
| 빌드 아티팩트 | 30일 | 플랫폼별 확장 바이너리 |
| 테스트 결과 | 7일 | 테스트 로그 및 결과 |
| 벤치마크 결과 | 90일 | 성능 추적용 |
| 보안 스캔 결과 | 30일 | 보안 감사 리포트 |
| 릴리스 아티팩트 | 90일 | 릴리스 패키지 |

## 실행 조건

### 자동 실행
- **모든 Push**: CI/CD 파이프라인 실행
- **Pull Request**: CI/CD + 성능 비교
- **Release 게시**: 릴리스 워크플로우
- **스케줄**: 보안 검사 (매일), 벤치마크 (주간)

### 수동 실행
- **벤치마크**: `workflow_dispatch`로 특정 벤치마크 타입 선택
- **릴리스**: `workflow_dispatch`로 수동 릴리스 생성

## 실패 처리

### 빌드 실패
- **부분 실패**: `fail-fast: false`로 다른 플랫폼 계속 빌드
- **의존성 실패**: 자동 재시도 및 캐시 무효화
- **테스트 실패**: 상세한 로그 및 아티팩트 업로드

### 보안 실패
- **취약점 발견**: 이슈 자동 생성 (향후 구현)
- **라이선스 위반**: 빌드 중단 및 알림
- **CodeQL 경고**: Security 탭에 결과 표시

### 성능 회귀
- **목표 미달**: 빌드 실패 및 상세 리포트
- **메모리 누수**: Valgrind 검사 실패 시 중단
- **벤치마크 실패**: 성능 비교 리포트 생성

## 개발자 가이드

### 로컬 테스트
```bash
# CI와 동일한 테스트 실행
cargo fmt --check
cargo clippy -- -D warnings
cargo test
cargo audit
cargo deny check

# 빌드 테스트
mkdir build && cd build
cmake .. -DBUILD_CPP_TESTS=ON
cmake --build . --parallel
ctest --output-on-failure
```

### 워크플로우 디버깅
1. **로그 확인**: Actions 탭에서 상세 로그 확인
2. **아티팩트 다운로드**: 실패한 빌드의 아티팩트 분석
3. **로컬 재현**: 동일한 환경에서 로컬 테스트
4. **환경 변수**: 필요시 디버그 환경 변수 설정

### 새 워크플로우 추가
1. `.github/workflows/` 디렉토리에 YAML 파일 생성
2. 적절한 트리거 및 권한 설정
3. 플랫폼 매트릭스 고려
4. 아티팩트 업로드 및 보존 정책 설정
5. 실패 처리 및 알림 구성

## 모니터링 및 알림

### 상태 모니터링
- **GitHub Actions 대시보드**: 워크플로우 상태 실시간 확인
- **배지**: README의 빌드 상태 배지
- **이메일 알림**: 실패 시 자동 알림 (GitHub 설정)

### 메트릭 추적
- **빌드 시간**: 플랫폼별 빌드 시간 추적
- **테스트 성공률**: 테스트 통과율 모니터링
- **성능 트렌드**: 벤치마크 결과 시계열 분석
- **보안 점수**: 취약점 및 라이선스 컴플라이언스

## 문제 해결

### 일반적인 문제
1. **Rust 툴체인 실패**: 캐시 무효화 후 재실행
2. **DuckDB 다운로드 실패**: 네트워크 문제, URL 확인
3. **플랫폼별 빌드 실패**: 의존성 및 링킹 문제 확인
4. **테스트 타임아웃**: 테스트 복잡도 및 리소스 확인

### 성능 문제
1. **빌드 시간 증가**: 캐시 효율성 및 병렬화 확인
2. **테스트 시간 증가**: 테스트 최적화 및 선택적 실행
3. **아티팩트 크기**: 압축 및 불필요한 파일 제거

### 보안 문제
1. **취약점 발견**: 의존성 업데이트 및 대안 검토
2. **라이선스 충돌**: 호환 라이선스로 대체
3. **CodeQL 경고**: 코드 수정 및 예외 처리

## 기여 가이드라인

### 워크플로우 수정
- 기존 워크플로우 수정 시 충분한 테스트
- 새 플랫폼 추가 시 전체 매트릭스 고려
- 성능 영향 최소화
- 문서 업데이트

### 테스트 추가
- 새 기능에 대한 적절한 테스트 추가
- CI에서 실행 가능한 테스트 작성
- 플랫폼별 차이점 고려
- 실행 시간 최적화

이 CI/CD 파이프라인은 DuckDB dplyr 확장의 품질, 보안, 성능을 보장하며 멀티플랫폼 배포를 자동화합니다.